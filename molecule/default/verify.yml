---
# This is an example playbook to execute Ansible tests.

- name: Verify
  hosts: all
  tasks:
    - name: runs mongod in background # noqa 301
      shell:
        cmd: mongod &

    - name: evaluates server status # noqa 301
      shell:
        cmd: "mongo --quiet --eval 'db.runCommand({ serverStatus: 1 }).ok'"
      ignore_errors: yes
      register: status_output

    - name: server runs ok
      assert:
        that:
          - status_output.rc == 0
          - status_output.stdout == '1'

    - name: register mongod version # noqa 301
      shell:
        cmd: mongod --version | head -n1 | cut -d' ' -f3
      ignore_errors: true
      register: mongod_version

    - name: the correct mongod version is installed
      assert:
        that:
          - mongod_version.stdout == 'v4.2.5'
